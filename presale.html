<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NUUR Token Presale</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #f4f4f4;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        .container {
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            padding: 40px;
            width: 100%;
            max-width: 500px;
            margin: 20px;
            text-align: center;
            animation: fadeIn 1s ease;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            font-size: 28px;
            color: #333;
            margin-bottom: 20px;
        }

        .button {
            background-color: #007BFF;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            margin: 10px 0;
        }

        .button:hover {
            background-color: #0056b3;
        }

        input {
            padding: 10px;
            width: 100%;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        input:focus {
            border-color: #007BFF;
        }

        .txn-status {
            margin-top: 20px;
            font-size: 16px;
            color: #333;
        }

        .txn-history {
            margin-top: 30px;
            text-align: left;
            max-height: 200px;
            overflow-y: auto;
            width: 100%;
            background: #f9f9f9;
            padding: 10px;
            border-radius: 5px;
        }

        .txn-history ul {
            list-style: none;
            padding: 0;
        }

        .txn-history li {
            background: #e9ecef;
            margin-bottom: 10px;
            padding: 10px;
            border-radius: 5px;
            font-size: 14px;
        }

        .footer {
            margin-top: 30px;
            font-size: 14px;
            color: #777;
        }

        .footer a {
            color: #007BFF;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>

    <div class="container">
        <img src="https://nuurtoken.site/logo.png" alt="NUUR Token" style="width: 120px; margin-bottom: 20px;">
        <h1>NUUR Token Presale</h1>

        <div id="wallet-status"></div>

        <button id="connect-wallet" class="button" onclick="connectWallet()">Connect Wallet</button>

        <div>
            <input type="number" id="sdaAmount" placeholder="Enter SDA Amount (1-100)" min="1" max="100" />
            <button class="button" onclick="buyNUUR()">Buy NUUR</button>
        </div>

        <div id="txn-status" class="txn-status"></div>
        <div id="add-token" class="txn-status"></div>

        <div class="txn-history">
            <h3>Transaction History</h3>
            <ul id="txn-history-list"></ul>
        </div>

        <div class="footer">
            <p>Trading involves risk. Always do your own research.</p>
            <a href="https://ledger.sidrachain.com/address/0x8F6FfB7B6BbfbBa563897B27FB784C5C5A8830E8" target="_blank">Donate to Developer</a>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/web3@1.6.1/dist/web3.min.js"></script>
    <script>
        let web3;
        let userAccount;
        const presaleContractAddress = "0x814bc34460590413664747336cCB5e54141cD8dA";
        const noorTokenAddress = "0x3f2C99C23eE666096d2cFda162A4bFBcC4AE8de8";
        let presaleContract;
        let noorTokenContract;

        // ABI for the presale contract
        const presaleABI = [{"inputs":[{"internalType":"address","name":"_noorToken","type":"address"},{"internalType":"address","name":"_devWallet","type":"address"}],"stateMutability":"nonpayable","type":"constructor"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"OwnableInvalidOwner","type":"error"},{"inputs":[{"internalType":"address","name":"account","type":"address"}],"name":"OwnableUnauthorizedAccount","type":"error"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"previousOwner","type":"address"},{"indexed":true,"internalType":"address","name":"newOwner","type":"address"}],"name":"OwnershipTransferred","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"buyer","type":"address"},{"indexed":false,"internalType":"uint256","name":"sdaAmount","type":"uint256"},{"indexed":false,"internalType":"uint256","name":"noorAmount","type":"uint256"}],"name":"TokensPurchased","type":"event"},{"inputs":[],"name":"buyNoor","outputs":[],"stateMutability":"payable","type":"function"},{"inputs":[],"name":"devWallet","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"noorToken","outputs":[{"internalType":"contract IERC20","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"rate","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"renounceOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newRate","type":"uint256"}],"name":"setRate","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnership","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawETH","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"amount","type":"uint256"}],"name":"withdrawNoor","outputs":[],"stateMutability":"nonpayable","type":"function"},{"stateMutability":"payable","type":"receive"}];
        
        async function connectWallet() {
            if (window.ethereum) {
                web3 = new Web3(window.ethereum);
                try {
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    userAccount = (await web3.eth.getAccounts())[0];
                    document.getElementById("wallet-status").innerText = "Wallet connected: " + userAccount;
                    presaleContract = new web3.eth.Contract(presaleABI, presaleContractAddress);
                    noorTokenContract = new web3.eth.Contract([{"constant":true,"inputs":[],"name":"symbol","outputs":[{"name":"","type":"string"}],"payable":false,"stateMutability":"view","type":"function"}], noorTokenAddress);
                    document.getElementById("connect-wallet").style.display = "none";
                } catch (error) {
                    console.error("User denied wallet connection");
                }
            } else {
                alert("Please install MetaMask!");
            }
        }

        async function buyNUUR() {
            const sdaAmount = document.getElementById("sdaAmount").value;
            if (sdaAmount < 1 || sdaAmount > 100) {
                alert("Amount must be between 1 and 100 SDA.");
                return;
            }
            const rate = await presaleContract.methods.rate().call();
            const noorAmount = sdaAmount * rate;

            const tx = await presaleContract.methods.buyNoor().send({
                from: userAccount,
                value: web3.utils.toWei(sdaAmount, 'ether'), // Assuming SDA is in Ether units
                gasPrice: web3.utils.toWei('0.000001', 'gwei') // Transaction fee set to 0.000001 Gwei
            });

            document.getElementById("txn-status").innerText = "Transaction successful! Check on Ledger: " + 
                `<a href="https://ledger.sidrachain.com/tx/${tx.transactionHash}" target="_blank">Transaction Hash: ${tx.transactionHash}</a>`;

            const txnHistory = document.getElementById("txn-history-list");
            const txnEntry = document.createElement("li");
            txnEntry.innerHTML = `Hash: <a href="https://ledger.sidrachain.com/tx/${tx.transactionHash}" target="_blank">${tx.transactionHash}</a>, SDA: ${sdaAmount}, NUUR: ${noorAmount}`;
            txnHistory.appendChild(txnEntry);

            document.getElementById("add-token").innerHTML = `
                <button onclick="addTokenToMetaMask()">Add NUUR to MetaMask</button>
            `;
        }

        function addTokenToMetaMask() {
            if (window.ethereum) {
                ethereum.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: {
                            address: noorTokenAddress,
                            symbol: 'NUUR',
                            decimals: 18,
                            image: 'https://nuurtoken.site/logo.png'
                        }
                    })
                    .then((success) => {
                        if (success) {
                            alert("Token added to MetaMask!");
                        } else {
                            alert("Token addition failed.");
                        }
                    })
                    .catch((error) => {
                        console.error(error);
                        alert("Something went wrong!");
                    });
            }
        }
    </script>
</body>
</html>
